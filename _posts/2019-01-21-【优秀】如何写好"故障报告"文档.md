---
layout:  post  # 使用的布局（不需要改）
catalog: true  # 是否归档
author: 陈国林 # 作者
tags:          #标签
    - 优秀
---

# 一. 背景
互联网公司相对于传统的公司来说产品的升级迭代非常频繁，频繁的升级意味着我们需要承担更大概率的故障风险。  
同时由于互联网产品通常是由很多模块组成的，所以模块化后由于依赖很多，出现故障的概率也是成倍增加。  

所以，出了故障后除了第一时间解决问题，还需要我们在故障修复后进行反思总结，所以这篇文章会告诉大伙儿，如何写好`故障报告`总结文档。

故障报告主要有以下几点作用
1. 故障报告能够让故障负责人复盘整个故障过程，了解故障的影响、故障发生的原因以及后续如何规避，加深对故障的理解。
2. 故障报告大部分都需要通过邮件、聊天工具等抄送给相关的同学知晓，所以详细的报告能让人快速了解整个故障的过程。
3. 故障报告具有警示作用，能够让开发和运维对线上更加敬畏，有利于减少故障的发生。

# 二. 故障报告
整个故障报告应该分为4个部分，分为`故障结论`、`故障过程`、`故障修复`、`后续优化`。

为什么`故障结论`要放在最前面呢，因为写文档有个原则就是**结论写在最前面**。因为有些人(老板)可能只关注结论并不关心细节，所以我们需要在开头就写明结论。

1. 故障结论   
   故障结论部分描述整个故障的结论，应该放在整个文档的最开头，让所有人一眼就能知道。故障结论包括以下几个方面  
    * 故障等级: 每个故障都有对应的等级，这个等级不同公司有不同的标准，一般来说是由运维和开发负责制定
    * 故障时间: 故障发生的时间点，持续了多久
    * 故障影响: 故障的具体影响，分点描述
    * 故障原因: 故障的原因，分点描述
  
2. 故障过程  
   故障过程部分描述故障从发生到处理到最终修复的整个过程，详细记录整个故障过程非常重要。
   能够让大家知道是否有哪些环节出现问题或者哪个环节处理不及时，有利于后续改进优化。

3. 故障修复  
   故障修复部分描述整个故障最终是如何解决的，针对不同的问题解决方案是什么样，分点描述。

4. 后续优化  
   后续优化部分描述故障修复以后该做哪些优化改进，分点描述。
  
# 三. 样例
```
2019.01.22 xxxx业务xxxx接口挂掉13分钟故障报告

一. 故障结论
   1. 故障等级: P2
   2. 故障时间: 2019.01.22 10:35 ~ 2019.01.22 10:48 持续13分钟
   3. 故障影响
      1). 用户访问xxxx接口响应500，故障期间共计2万次请求，受影响请求有5000，影响请求占比25%。
      2). 故障期间共计访问用户2000人，受影响用户有800人，影响用户占比40%。
   4. 故障原因
      1). xxxx服务依赖Mysql存储服务不可用，导致xxxx接口在请求Mysql数据的时候报错，所以直接返回500。
      2). Mysql服务不可用的原因是机器磁盘满了，导致服务不可用。

二. 故障过程
   1. 2019.01.22 10:35 收到电话报警，发现xxxx接口响应报500错误。
   2. 2019.01.22 10:36 @陈国林 开始在xxxx群里面周知相关同学。
   3. 2019.01.22 10:37 @陈国林 联系运维同学 @张三 告知发生故障并开始处理。
   4. 2019.01.22 10:38 @陈国林 联系DBA同学 @李四 告知发生故障并开始处理。
   5. 2019.01.22 10:39 @陈国林 上xxxx平台/xxxx机器查看服务日志，发现是Mysql连接报错导致。
   6. 2019.01.22 10:40 @陈国林 在xxxx群里面告知 @李四 是因为Mysql连接报错，找他排查确认。
   7. 2019.01.22 10:45 @李四 在xxxx群里面告知 @陈国林 Mysql服务不可用是因为磁盘满导致的，正在删除磁盘数据。
   8. 2019.01.22 10:47 @李四 在xxxx群里面告知 @陈国林 Mysql服务恢复。
   9. 2019.01.22 10:48 @陈国林 验证服务恢复在xxxx群里面告知 @张三 @李四 服务恢复。

三. 故障修复
   1. xxxx接口不可用最根本的原因是因为Mysql服务不可用导致，Mysql服务不可用的原因是因为机器磁盘满了导致的，所以修复这个问题只需要保证Mysql实例机器有足够的磁盘空间即可。
   2. xxxx业务现在获取不到Mysql数据会直接响应HTTP 500错误，业务层面需要使用Redis做缓存即使Mysql挂了缓存的数据还在，保证服务可用。

四. 后续优化
   本次Mysql服务不可用，DBA和运维都没有收到响应的监控报警导致故障延迟修复，需要加上相应的监控报警，同时业务层面需要加上Redis做缓存。
   1. @李四 今天负责加上Mysql实例服务可用性监控，保证Mysql服务挂掉的时候DBA能够感知。
   2. @张三 今天负责加上磁盘使用率监控，超过90%就报警，保证运维能够及时处理。
   3. @陈国林 明天之前负责对xxxx接口实现做优化，加上Redis做缓存，保证服务可用。
```


