---
layout:  post    # 使用的布局（不需要改）
catalog: true   # 是否归档
author: 陈国林 # 作者
tags:         #标签
    - Go
---

# 一. 开发总监

文章的目的是为了把使用Golang开发过程中遇到的相关问题记录汇总下来，方便后续再碰到的时候可以快速解决

1. HTTPS请求报 `x509: certificate signed by unknown authority`  
   问题原因: HTTPS证书校验失败  
   解决方案: 定义TLSClientConfig 忽略证书校验
   ```
   tr := &http.Transport {
       TLSClientConfig: &tls.Config{InsecureSkipVerify: true},
   }
   
   client := &http.Client{Transport: tr}
   ```
   
2. Go主协程需要等待其它协程结束后再退出，否则会导致goroutine未结束进程就退出了  
   通常情况下我们会使用一个channel来实现，具体的实现原理是 `channel在没有数据的时候接收操作会一直阻塞`，当所有的goroutine都结束的时候可以close掉这个channel，这样接收操作就不会阻塞，主协程就可以继续往下执行
   ```
   func main() {
       ...
    
       // block until shutdown channel closed
       shutdown := make(chan struct{})
       registerSignal(shutdown)
       // 一直阻塞直到shutdown有数据 或者 被close
       <-shutdown
    
       ...
   }

   // registerSignal register kill signal
   func registerSignal(shutdown chan struct{}) {
       c := make(chan os.Signal)
       signal.Notify(c, os.Interrupt, syscall.SIGHUP, syscall.SIGINT, syscall.SIGTERM)

       go func() {
           defer func() {
           if err := recover(); err != nil {
               log.Error("[registerSignal] panic error: ",
 		           log.Object("error", err))
 	           debug.PrintStack()
           }
       }()

       for sig := range c {
 	       // close shutdown channel
 	       close(shutdown)
 	       log.Info("[registerSignal] receive system signal:" +
 	            sig.String() + ", going to shutdown ...")
 	       return
       }
   }()
   ```

3. 
   
   
   
   
