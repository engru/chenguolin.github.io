---
layout:  post  # 使用的布局（不需要改）
catalog: true  # 是否归档
author: 陈国林 # 作者
tags:          #标签
    - BitCoin
---


# 一. 交易时间锁
比特币从一开始就有一个交易级别的时间锁定功能，由交易中的nLocktime字段实现。
在2015年底和2016年中期推出了两个新的时间锁定功能，提供UTXO级别的时间锁定功能。这些字段分别为CHECKLOCKTIMEVERIFY和CHECKSEQUENCEVERIFY。

交易锁定时间是交易级别锁定时间限制，它定义交易能够被添加到区块链网络中最早时间，锁定时间字段为nLocktime。

1. 大多数情况下交易nLocktime设置为**0**，表示交易需要立刻被打包和执行。
2. 如果nLocktime不为0
	* 小于**5亿**则表示最小的块高度，定义交易能够被添加到区块链网络中最小的块高度
	* 大于**5亿**则表示最小的时间戳，定义交易能够被添加到区块链网络中最小的时间戳

`交易锁定时间nLocktime有个问题是没有办法阻止一笔交易被双花，例如A给B转账限制3个月后生效，但是期间A完全有可能花费掉这笔交易的UTXO`

# 二. 相对时间锁nSequence
可以在每个交易输入中设置nSequence字段设置相对时间锁定
`nSequence字段的设计初心是想让交易能在在内存中修改，使用nSequence这个字段时，如果输入的交易的序列值小于2^32（0xFFFFFFFF），就表示尚未“确定”的交易。因此，一般情况下nSequence的值通常设置为2^32`

## ① nSequence用途汇总
1. 一笔交易输入nSequence等于**2^32（0xFFFFFFFF）**，表示没有使用相对时间锁，交易可以被立即验证和打包
2. 一笔交易输入nSequence小于**2^32-1（0xFFFFFFFF-1）**，Bitcoin Core 0.12+版本之后表示当前交易在Mempool中允许被覆盖
3. 一笔交易输入nSequencen小于**2^31**时，表示使用相对时间锁。这种交易只有到了相对锁定时间后才生效。
