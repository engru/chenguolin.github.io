---
layout:  post  # 使用的布局（不需要改）
catalog: true  # 是否归档
author: 陈国林 # 作者
tags:          #标签
    - BitCoin
---

# 比特币概述
   如下图所示，比特币系统由用户（用户通过密钥控制钱包）、交易（每一笔交易都会被广播到整个比特币网络）和矿工（通过竞争计算生成在每个节点达成共识的区块链，区块链是一个分布式的账本， 包含了比特币网络发生的所有的交易）组成。
   ![](http://upload-images.jianshu.io/upload_images/1785959-cf934db5a82e4f15.png?imageMogr2/auto-orient/strip|imageView2/2/w/1240)

# 比特币交易
   简单来说，交易告知全网：比特币的持有者已授权把比特币转帐给其他人。而新持有者能够再次授权，转移给该比特币所有权链中的其他人，产生另一笔交易来花掉这些比特币，后面的持有者在花费比特币也是用类似的方式。

## 交易输入和输出
  每一笔交易包含一个或多个输入，同时包含一个或多个输出。输入和减去输出和即为交易矿工费。
  如下图所示，输入值为0.55BTC, 输出值为0.50BTC, 交易矿工费为0.05BTC。
  ![](http://upload-images.jianshu.io/upload_images/1785959-c7cf6f784e8b668b.png?imageMogr2/auto-orient/strip|imageView2/2/w/1240)

## 交易链
比特币交易最终会形成一条链，最近的交易输入对应之前的交易输出。
用户通过密钥解锁之前的交易输出证明自己拥有该比特币资产，交易输出的时候在交易里加上指定收款用户地址，明确要求指定用户才能消费该资产。
![](http://upload-images.jianshu.io/upload_images/1785959-c4328de4862c73fd.png?imageMogr2/auto-orient/strip|imageView2/2/w/1240)

## 找零
由于比特币没有办法分割，因此许多比特币的交易都包含有找零的输出。举个例子，比如用户输入值为20BTC，但是交易只需要涉及到15BTC，因此剩下的5个BTC通常会转到自己的地址下（还需要考虑矿工费），这个过程称为找零。

# 交易构建
## 获取交易输入
1. 大多数钱包都会维护某个地址的所有UTXO（未花费输出），因此钱包会为每个地址找到满足的输入交易
2. 如果钱包未维护某个地址的UTXO，可以通过HTTP请求某个节点获取当前地址的UTXO集合。 curl https://blockchain.info/unspent?active=1Cdid9KFAaatwczBwBttQcwXYCpvK8h7FK

## 构建交易输出
1. 每笔输出包含一个脚本，脚本用于验证谁能真正的解锁该输出
2. 每笔输出包含找零
3. 每笔输出还包含交易手续费，输入和输出差值即为手续费

## 交易广播
由于比特币系统是一个P2P网络，因此任何比特币客户端收到一个有效的交易后都会迅速的把当前交易广播给和自己连接的节点，因此交易便能够在很短的时间内广播给所有节点。

# 比特币挖矿
交易在比特币网络中广播之后，只有经过矿工挖矿验证并添加到一个区块之后，这个交易才会成为区块链上的一部分。
比特币系统共识机制是通过大量的计算证明来实现的，交易被打包进区块需要极大的工作量证明，但是区块被验证确只需要少量计算即可。

挖矿在比特币系统中有2个重要的作用
1. 挖矿节点通过参考比特币的共识规则验证所有交易。 因此，挖矿通过拒绝无效或畸形交易来提供比特币交易的安全性。
2. 挖矿在构建区块时会创造新的比特币，和一个中央银行印发新的纸币很类似。每个区块创造的比特币数量是固定的， 随时间会渐渐减少。

# 比特币区块交易记录
新交易不断地从用户钱包和应用流入比特币网络。当比特币网络上的节点看到这些交易时，会先将它们放到各自节点维护的一个临时的未经验证的交易池中。

当矿工构建一个新区块时， 会将这些交易从这个交易池中拿出来放到这个新区块中，这些交易被加进新区块时，以交易费用高的优先以及其它的一些规则进行排序。然后通过工作量证明这个新区块的合法性。

随着时间变长，区块链的高度也随之增长，每个区块和整个链的计算复杂度也随之增加。
按惯例来说，一个区块获得**6次**以上“确认”时就被认为是不可撤销的了，因为要撤销和重建六个区块需要巨量的计算。
![](http://upload-images.jianshu.io/upload_images/1785959-03ad3e15f83bb351.png?imageMogr2/auto-orient/strip|imageView2/2/w/1240)

