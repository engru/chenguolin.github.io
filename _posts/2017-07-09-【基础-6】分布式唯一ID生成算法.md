---
layout:  post  # 使用的布局（不需要改）
catalog: true  # 是否归档
author: 陈国林 # 作者
tags:          #标签
    - 基础
---

# 一. 背景
在分布式系统环境下，需要对大量的数据和消息进行唯一标识。例如电商系统订单ID需要全局唯一，还有当我们业务增长到一定级别之后往往单一的数据库已经不能满足业务需求，我们就需要做分库分表，在对数据库做分库分表后数据库的自增ID显然已经不能满足需求，需要有一个唯一ID做为主键用来标识一条数据。

因此，我们需要一些算法用于生成唯一ID。生成唯一ID的方法有很多，适应不同的场景、需求以及性能要求。有些比较复杂的系统会有多个ID生成的策略，下面就介绍一些常见的唯一ID生成算法。

# 二. 解决方案
## ① 数据库自增ID
`数据库自增ID` 是最常见的分布式唯一ID生成解决方案，适用于业务数据量比较小，只需要单表就能够满足数据存储需求。部署在分布式系统上的业务，读写都在同一个数据库表，就可以通过数据库自增ID来唯一标识一条数据。

做法是业务在定义Mysql table schema的时候设置 `id` 字段并设置为主键ID

```
CREATE TABLE `users` (
  `id` BIGINT(20) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `uid` BIGINT(20) UNSIGNED NOT NULL DEFAULT 0 COMMENT '用户uid',
  `name` VARCHAR(50) NOT NULL DEFAULT '' COMMENT '用户名称',
  `phone` VARCHAR(20) NOT NULL DEFAULT '' COMMENT '用户电话',
  ...
  `create_time` BIGINT(20) UNSIGNED NOT NULL DEFAULT 0 COMMENT '创建时间',
  `update_time` BIGINT(20) UNSIGNED NOT NULL DEFAULT 0 COMMENT '更新时间',
   PRIMARY KEY (`id`),  #主键id字段
   UNIQUE KEY `uk_uid` (`uid`) USING BTREE COMMENT '唯一索引'
) ENGINE=InnoDB AUTO_INCREMENT=45 DEFAULT CHARSET=utf8mb4 COMMENT='用户表';
```

## ② UUID
`UUID` universally unique identifier是一个128位并用16进制展示的唯一标识ID，数据格式为 `123e4567-e89b-12d3-a456-426655440000` (16进制)，每一段数据的含义可以参考 [UUID Format](https://en.wikipedia.org/wiki/Universally_unique_identifier)，两次生成相同UUID的概率几乎为0，因此UUID也经常被用来做为唯一标识ID使用。

但是 `UUID` 存在一个问题就是128位太长了，我们知道常见的整型最大为64位，因此128位的`UUID` 做为唯一ID的时候不太适合用来做索引，当如果数据量太大的时候`UUID` 索引可能会影响查询性能。

Golang `UUID` 生成可以参考 [uuid](https://github.com/google/uuid)

```
import (
	"github.com/google/uuid"
)

// NewUUID Generate Universally Unique ID
// uuid format: 123e4567-e89b-12d3-a456-426655440000
func NewUUID() string {
	return uuid.New().String()
}
```

## ③ MongoDB ObjectId
[MongoDB ObjectId](https://docs.mongodb.com/manual/reference/method/ObjectId/) 是一个96位并用16进制展示的唯一标识ID，类似`507f1f77bcf86cd799439011` (16进制)。

MongoDB ObjectId 数据由3部分组成

1. 4字节: 时间秒数
2. 5字节: 随机数
3. 3字节: 计数器，从随机数开始计数

## ④ Database Ticket Servers

## ⑤ Twitter Snowflake



