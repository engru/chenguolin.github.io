---
layout:  post    # 使用的布局（不需要改）
catalog: true   # 是否归档
author: 陈国林 # 作者
tags:         #标签
    - Linux
---

1. SVN 版本控制使用  
   1). svn删除远程仓库但是保持本地: svn del spam_host_recover/build spam_host_recover/result --keep-local



8.  sed 把所有的大写字母转换成小写字母
    sed 's/[A-Z]/\l&/g' file


11. svn打branch
     1. svn cp http://svn.simba.taobao.com/svn/Apsara/leopard/db/common/feature_merger/trunk/ (trunk地址) http://svn.simba.taobao.com/svn/Apsara/leopard/db/common/feature_merger/branches/chenguolin_20141024 (要创建branch地址) -m "mkdir branch"
     2. svn switch http://svn.simba.taobao.com/svn/Apsara/leopard/db/common/feature_merger/branches/chenguolin_20141024
     3. svn info查看是否切换到branch
     4. branch merge回trunk
         a. 先切换到trunk
         b. svn merge --reintegrate http://svn.simba.taobao.com/svn/Apsara/leopard/db/common/feature_merger/branches/chenguolin_20141024
         c. 查看diff是否merge成功
     5. svn查看branch和trunk的diff
         svn diff --old http://svn.simba.taobao.com/svn/Apsara/leopard/db/common/feature_merger/branches/chenguolin_20141024 --new http://svn.simba.taobao.com/svn/Apsara/leopard/db/common/feature_merger/trunk/
     6. svn revert某个文件: svn revert file
         svn revert某个文件夹: svn revert -R dir
     7. svn 意外删除某个文件夹，可以用: svn update dir 来恢复。   
     8. svn 两个branch merge，例如yyy/branch merge到 xxx/branch
         a. 先切换到branch: svn switch xxx/branch
         b. svn merge --reintegrate yyy/brahch .
         c. svn diff 查看diff情况
     9. svn 利用版本号merge 到本地的work copy
         a. 确认本地的work的svn info
         b. svn merge -r v1:v2  yyy/branch   //把yyy这个branch从v1->v2版本之间所有的修改merge到本地work copy
         c. svn diff  查看diff
     10. galaxy_bot, may102010

12. 查看生成的ucClientCmStat sstable数据
      a. 主机: 10.99.20.73 /tmp/目录下
      b. 命令: leopard_reader -so libsm_proto.so -m sm_proto.gaia.UcClientCmStat  -i pangu://AT-Offline-17/home/mingwang.xmw/uc/uc_browse_log_denoising/output/2014_10_19/2014_11_10_21_03_31/from_0_to_1048576_32/29 -l 100 

13. 删除某个目录下所有.svn文件夹
      a. find . -name *svn   --查看所有.svn文件夹
      b. find . -name *svn | xargs rm -rf  --删除所有.svn文件夹
      
14. 把某个文件夹下对应所有.svn移动到 另一个对应文件夹下
     a. find  . -name .svn -print0 | xargs -0 -I {} mv '{}' '../uc_browse_log/{}'
     b. find . -name "build_options.py" -print0 | xargs -0 -I {} cp ./uc_browse_log/build_options.py '{}'  //把uc_browse_log下的build_options.py移动到当前目录的所有子目录下

15. 查看job是否因为OOM被kill
     1. sudo vim /var/log/messages
                           /var/log/kern
     2. 找对应的task的名称

17. 查看shenma-dev下ha2集群所有机器的date
     r tfrl | grep "ha2" | awk '{print $1}' | xargs -I '{}' ssh '{}' date

18. 集群ip地址
      AT-Offline-17: 100.81.164.109
      离线集群隔离机器: 100.82.23.21
      AT-Offline-4: 10.99.16.80
      AY54: 10.206.28.28
      AY500: 10.181.205.1
      job_tools new: 10.206.40.156
      job_tools_4: 10.206.24.35
      shenma-dev. 10.181.207.7
      sparkag: 11.251.181.112, 11.251.181.113
     search-offline@list.alibaba-inc.com
     数据配置pangu目录: pangu://AT-Shenma-dev/home/chenguolin/

21. counter check命令（domain_classify）
      python /home/admin/ha_pe_work/gaia/local_install/usr/local/lib/python/site-packages/gaia_job_scripts/counter/check_counter.py /home/admin/ha_pe_work/gaia/gaia_main/conf/gaia_main.conf /home/admin/ha_pe_work/gaia/local_install/usr/local/bin/counter_client /home/admin/ha_pe_work/gaia/local_install/usr/local/lib/python/site-packages/gaia_job_scripts/domain_classify/expr.list main_counter

22.  Metrics前端展示工具
     1. 主机: 10.99.16.86 
     2. 所有metrics: /home/wenxiang.liwx/liwenxiang/nginx_data/uclog_trans/data_store 

23. rpm命令
      rpm -q samba //查询程序是否安装
      rpm -qa | grep httpd    // 搜索指定rpm包是否安装
      rpm -ql httpd         // 搜索rpm包
      rpm -qpi Linux-1.4-6.i368.rpm // 查看rpm包信息
      rpm -qpf Linux-1.4-6.i368.rpm // 查看rpm包的文件
      rpm -ivh file.rpm  // 安装新的rpm包
      rpm -Uvh file.rpm    // 升级一个rpm包
      rpm -e file.rpm      // 删除一个rpm包
      rpm -qa --root=/home/admin/chenguolin/workdir/project/_external/ | grep google_url  #指定路径查看是否安装google_url rpm包

      1. 用yum provides xxx 可以用来查看哪些rpm包中包含xxx文件，例如 yum provides libjvm.so
      2. 如果想查看本机已经安装的某些文件是属于哪个rpm包，可以用以下方法: rpm -qf /usr/local/lib64/libjvm.so
      3. yum search xxx  可以搜索系统下的xxx rpm包
      4. sudo find / -name libjson_linux-gcc-4.6_libmt.so   系统根目录下查找某个so的路径
      5. 上传rpm包到test或release源: repotool upload *.rpm -f test 或 repotool upload *.rpm -f release
      6. rpm指定安装位置: 
          1). rpm -qpl xxx.rpm 查看rpm包的默认安装目录 
               比如rpm包默认安装目录是 /usr/bin，我们希望重定向到/home/admin/chenguolin/
          2). rpm -ivh --relocate /usr/bin=/home/admin/chenguolin xxx.rpm

24. 小说和酷影
      1. http://10.1.72.173/nemoread/master/result/conf/
      2. http://10.1.72.173/nemoread/master/result/

25. 所有顶级域名和二级域名列表
      https://publicsuffix.org/list/effective_tld_names.dat

26. uclog counter值存入mysql
      ip: 11.226.2.68:13307
      mysql_user = gaia
      mysql_passwd = gaia@2014
      mysql_db = statistic_metrics
      mysql_table = gaia_uclog_statistic

27. AY54上查看爬虫抓取记录
      /home/admin/ha_pe_work/hubble/bin/MetricsSearchTool.sh fetch_gph day 2015-01-08 webSearch once1 mp.weixin.qq.co
     day: 表示哪一天的抓取记录
     webSearch: 抓取group
     once1: 第几个partition
     mp.weixin.qq.co: 查询的host

28. 所有pattern的pangu地址
     pangu://AY54/product/hubble/layer/pattern/

29. MySQL常用命令
     1. 登录命令: mysql -h localhost --port port -u myname -p mypass mydb
     2. 查看某个table的列名: desc tableName;
         查看所有db; show databases;
         清空一个table: truncate table table;
     3. 已有的表添加一列: alter table tableName add cloumnName type;
     4. 调整列的顺序: alter table tableName modify cloumnName varchar(100) first;
                                  alter table tableName modify cloumnName varchar(100) after cloumnName2;
     5. python 操作mysql数据库，如果是insert、update、delete都必须要提交事务commit，抛异常回滚rollback
     6. 删除一行: delete from tableName where condition;
     7. shell脚本执行mysql命令: /usr/bin/mysql -h 10.99.84.63 -P 3307 -u gaia --password=gaia@2014 --execute="delete from test.youhui_test_log where gmt_create < NOW() - INTERVAL 345600 SECOND;"
     8. select结果按列显示: select * from feed_kuaibao where id = 110872 \G;

30. uclog Metrics配置文件 
   ~/ha_pe_work/offline_metrics/metrics/jobs/debugging_xmw/conf/querylog_top3_gaia.conf

31. 跑二进制文件
     /bin/env LD_LIBRARY_PATH=build/release64/packages/staging/uc_log/ build/release64/bin/url_tool

32. op抓取
    种子: pangu://AY54/product/gaia/op_crawl_seed//host/baidu/
    抓取结果原始记录: pangu://AY54/product/gaia/main/external/op_crawl_index_fetched/

33. 正则表达式，转义字符
    .  $  ^  {  }  [  ]   (  )   |   *  +   ?   \
   a. 正则表达式中[]如果想要表示-，需要转义 \-

34. 线上使用pattern前端使用GetDomain
    /var/www/html/urlpattern/GetDomain

35. 分析job detail，得到每个instance的开始和结束时间
    python /apsara/deploy/rpc_wrapper/jobstatus_parse.py ~/ha_pe_work/gaia/uclog/job_detail_log/uclog_uc_log_merge.2015_03_03_12_18_13.detail.json tid

36. ODPS账号密码
    a. vpn + http://10.97.244.9:8888
    b. 域账号：HZ\mingwang.xmw
        云账号：DXP_32594819@aliyun.com
        accessId：FpWsr4r4aJetczCi
        accessKey：rXk2Cziy42w18dMJ7FiG7hmQewaaA7

    c. http://service-corp.odps.aliyun-inc.com/api
    d. project: aliyun_searchlog
        tables: online_web_uc_cmstats,online_web_uc_cmstats_clean,online_web_uc_cmstats_clean_tmp
    e. 查询时间戳: UNIX_TIMESTAMP(at)  = 1425459385

    odps帮助文档: http://odps.alibaba-inc.com/doc/prddoc/odps_sql/odps_sql_func.html#regexp-count     

    1. 查询uniq url的条数: select count(distinct url) from online_web_uc_cmstats_clean where day = 20150608 and url like 'http://zhidao.baidu.com/%'

37. python常用文件操作
     a. 判断文件是否存在: os.path.exists(file_path)
     b. 删除文件: os.remove(file_path)
     c. 删除空目录: os.rmdir(dir_path)
     d. 删除非空目录: shutil.rmtree(dir_path)

38. job分析常用手段
     a. gaia日志 gaia.log
     b. 伏羲日志 job_name.LOG
     c. 土伯日志  /apsara/tubo/tubo.LOG
     d. cgroup记录kill instance日志  dmesg.sh，可以查看instance是否是因为OOM被kill     

39. hamal拷贝工具
     用于pangu大数据的拷贝，job的默认优先级是1120，工具使用详见命 令：python /usr/local/lib/python/site-packages/hamal/hamal_copy.py -h
     AY500上使用: /home/admin/ha_pe_work/tools/usr/local/lib/python/site-packages/hamal/hamal_copy.py

40. tubo corefiles的目录
      /apsara/tubo/corefile

41. dump平台设置代理
      42.120.173.9:9999

42. AY500访问AY55pangu空间，需要加上参数
      --pangu_client_EnableUsingKrpc=1

43. 查看job编译好的二进制，依赖的so
     a. fuxi 起job的时候默认把系统的LD_LIBRARY_PATH指定到build/release64/packages/staging/xxx下
     b. /bin/env LD_LIBRARY_PATH="./" ldd uc_log  指定LD_LIBRARY_PATH 可以查看二进制uc_log依赖的so

44. screen 配置
     escape ^Jj
     caption always "%{=B Bb} %{=B YK}%-w%<%{=B Rk} %n %t /%{=B GK}%+w%-02=%{=B B"

45. 强制保存vi文件
     w !sudo tee %   // %代指当前文件名, !sudo tee %表示用sudo权限输出到标准输出并且保存到当前文件中。
     可以再.vimrc里面配置 command W w !sudo tee % > /dev/null

46. spark
     a. 提交 spark-submit --num-executors 64 --executor-cores 4 --executor-memory 20G o2o_doc_process.py  // spark rdd的partition数不能比并发数少，并发数=executors*cores
     b. kill job: yarn application -kill  id

47. gtool账号密码
     1. 知识库o2o: 
         http://gtools.alibabalabs.com/baike/extract_item.php?do=manage 
         guolin.chen ; guolin.chen@sm
     2. o2o数据中心
              http://gtools.test.com/uc/
              chenguolin; chenguolin123456
         o2o运营平台
              http://boss.m.sm.cn/datacenter/CrawlDataManage.php?do=manage
              guolin.chencgl  guolin.chencgl123456
     3. url_mapping
         http://gtools.alibabalabs.com/quality2/url_mapping_wap.php?do=manage
         jian.xujian 密码123456
     4. u星基地
         账号: chengl
         密码: 同阿里
     5. 种子管理平台/pattern工具
        网址:http://gtools.alibabalabs.com/uc/index.php 
        账号密码: hubble，hubble@aliyun
    6. 应用管理平台
        http://gtools.alibabalabs.com/content/application.php
         账号密码: guolin.chen ; guolin.chen@sm
     7. sc升级平台，用户名+密码
         用户名:  guolin.chencgl
         密码: serving
   
48. 查看磁盘空间使用情况
     1. du -sh /home
     2. df /home
     3. du -c --max-depth=1 | sort -n -r

49. 操作sm db表命令(AY54和shenma-dev)
    1. cd /home/admin/ha_pe_work/sm_db/db_tools/db_tools/
   2.  flush: ./bin/service.py flush o2o -c deploy/json/sm_db_server.json
        full merge: ./bin/service.py full_merge o2o -c deploy/json/sm_db_server.json
        table upgrade: ./bin/service.py table upgrade o2o -c deploy/json/sm_db_server.json -s deploy/local_root/
        show full merge: ./bin/service.py show full_merge o2o -c deploy/json/sm_db_server.json
        metrics table: ./bin/service.py metrics table smk_o2o -c deploy/json/sm_db_server.json
   3. 查看db第几个partition的状态: ./bin/service.py show brief o2o -c deploy/json/sm_db_server.json -i 2
   4. 查看smdb服务的异常情况:  ./bin/service.py show alarm o2o_images -c ./deploy/json/sm_db_server.json
   5. smdb partition重启: ./bin/service.py table restart gaia_urldb_main -c ./deploy/json/sm_db_server.json -i 0  
   6. 卸载smdb: ./bin/service.py table del ...
       加载smdb: ./bin/service.py table add ...
   smdb服务异常排查
   1. 先查看smdb的异常情况，定位是否有相应的table有异常
   2. 查看对应表的状态和partition的情况
   3. 登录对应的机器 查看相应的sm_db.log

50. 查看sm db表的信息
    a. shenma-dev: pangu://AT-Shenma-dev/product/sm_db_test/server/
    b. AY54: pangu://AY54/product/sm_db/server/
    c. 读 smdb
        方式: leopard_reader  -i pangu://AT-Shenma-dev/product/sm_db_test/server/online_data/o2o/db_root/0/2015_08_11_16_16_44//__o2o_o2ostruct__ -m sm_proto.o2o.O2oStruct -l 1
        方式2: leopard_reader -i pangu://AY54/product/sm_db/server//online_data/o2o/db_root/2/2015_12_30_11_31_36/__leopard_pagemeta__ -m sm_proto.leopard.PageMeta -k "B49E75B973F23A79CDC51CDB1D1D9570" -kt HEX_KEY

59. smdb fail pass check
    1. 查看check log: /home/admin/ha_pe_work/sm_db/db_tools/db_tools/check_binary/sm_db.log 是否有错误log
        删除 ~/ha_pe_work/sm_db/db_tools/db_tools/deploy/local_root/online_data/ 这个目录下对应表的目录
    2. 重试

51. asvn co所有源代码
    a. 可以配置svn_option= --username yourusername --password yourpassword --non-interactive 这样无需每次都输入账号和密码

52. 解压ha3 doc的gz文件
    a. gzip -c -d 0.gz > a

53. rpm解压
    a. rpm2cpio xx.rpm | cpio -div

54. swift
    a. ~/ha_pe_work/swift_012/usr/local/bin/swift

55. nest amonitor
    http://10.181.206.16/amonitor/?sst=-4+hour&set=now&sn=nest

56. publish平台上线，遇到rpm install失败问题，解决方案
    a. 检查是否还有进程连接相关rpmdb。命令：lsof | grep rpm，kill -9 任何和自己的installroot相关的进程
    b. 删除db内的临时文件：sudo rm -vf ${installroot}/var/lib/rpm/__*
    c. 重建rpmdb：sudo rpm --rebuilddb --root=${installroot}
        如果未能解决问题，请重复步骤b-c

57. sm_stream python插件跑ut
    /bin/env LD_LIBRARY_PATH=$LD_LIBRARY_PATH:./python_processor_base/ python2.7 xxx.py

58. osscmd 和odpscmd使用
    阿云id和key: 
    账号: bsmagfqakmml@aliyun.com
    project=aliyun_searchlog
    id=1P5K9NcA0v7fDxlb
    key=NSaGhsUpK83MJqRE0sLsNvnAr2j4GR
    end_point=http://service.odps.aliyun-inc.com/api
    配置: osscmd config --id=1P5K9NcA0v7fDxlb --key=NSaGhsUpK83MJqRE0sLsNvnAr2j4GR --host=oss-cn-hangzhou.aliyuncs.com
    a. 上传目录
        osscmd --id=1P5K9NcA0v7fDxlb --key=NSaGhsUpK83MJqRE0sLsNvnAr2j4GR uploadfromdir 2015_10_22_14_57_13/ oss://080216/o2o/part4-2015-10-22
    b. 下载目录
        osscmd --id=1P5K9NcA0v7fDxlb --key=NSaGhsUpK83MJqRE0sLsNvnAr2j4GR downloadtodir oss://080216/o2o/part1+part2 review --replace=true
    
   1. linux使用odpscmd
       i). http://odps.alibaba-inc.com/download.htm#/collapseOne 点击下载tar包
      ii). 解压tar包, binary在bin目录下, 在conf目录下配置即可（注意project必须是用户有权限的项目）
   
   2. 阿里云内部文档: http://vipdocs.aliyun-inc.com/internal#/inter/odps/SQL/ddl
   3. odps表授权给具体的用户
       命令: grant Select on Table t_sm_youhui_zhuanti to USER aliyun$bsmagfqakmml@aliyun.com;
       odps权限授权: http://vipdocs.aliyun-inc.com/internal#/inter/odps/security/authorization_dac&authorization

60. odpscmd 使用
    可以使用odpscmd来操作具体的odps表
    1. odpscmd -u accessId -p accessKey
    2. use project //具体可以查看http://vipdocs.aliyun-inc.com/internal#/inter/odps帮助
    3. Add Partition: alter table t_sm_youhui_full_dump add partition(day='20160306');
    4. 修改分区数据: insert overwrite table table1 partition (day='20160306') select co1,co2 ... from table2 where = xxx;
        注意: table2 select选择的列名需要和table1列顺序一致，否则会导致数据对不上。   

61. smdb实时查询
    1. 利用sm_db_reader ut 满足smdb实时查询需求
    2. /home/admin/chenguolin/guolin.chencgl/project/cpp_plugin/sm_db_reader/sm_db_reader/sm_db_reader/test

62. abxp yum源问题解决方案
    问题: abxp经常有时候找不到对应的yum源，或者是yum源有问题，导致abxp失败
    解决方案:
              1. 确定具体有问题的yum源
              2. 到/etc/yum.repos.d  把相应的yum源mv成.bak文件
                  或者http://shenma_repo.proxy.taobao.org/zhangchi/ 替换/etc/yum.repos.d
              3. 确定是否可以abxp

63. 爬虫ip
     42.156.136.*-42.156.139.* 
     42.120.160.*
     42.120.161.* 
     42.120.234.*-42.120.236.*
     42.156.254.*

64. 神马内部工具
     1. stream: http://sm-stream.yisou.com/
     2. publish: http://dumpcenter.sm.cn:9999/publish/
     3. dump: 代理(42.120.173.9:9999)+http://10.206.28.28:8089/#Dump
     4. scheduler: http://sm-scheduler.yisou.com:8080/
     5. nest: http://nest.sm.cn/
     6. smdb配置wiki: http://wiki.shenma-inc.com/index.php/TableInfoExample
     7. ark数读报表统计: http://shudu.sm.cn/statistic/report_index/
     8. 线上amonitor: http://amonitor.yisou.com/

65. 离线垂类web service
     10.206.24.35

66. nest使用
     1. 修改了swift配置需要停止cluster再启动cluster才能生效

67. taobao rpm查询工具
     1. http://rpm.corp.taobao.com/

68. 查看集群chunkserver状态
     1. /apsara/deploy/puadmin lscs |grep tcp 

69. 重启gaia_aux
     1. 从spam_host_recover开始恢复
        pipeline_tools.py -c conf/pipeline_main.conf -k gaia_aux -t spam_host_recover,host_opindex_selection,opindexnum_analysis,host_info_transfer,cms_feedback_calculate_for_websearch,fast_refresh_interval_compute,css_selection,aux_counter_dump,hostdb_metrics_dump_job

70. pscp -h iplist scrdir destdir  集群一键拷贝
 
